# üß™ Checklist de Testes - AuthGuard (Fase 8)

## üìã Vis√£o Geral

Este documento cont√©m uma lista completa de testes para validar o funcionamento do **AuthGuard** (prote√ß√£o client-side) implementado na Fase 8.

**Data de Cria√ß√£o**: 2025-10-22  
**Fase**: 8 - AuthGuard (Prote√ß√£o Client-Side)  
**Componentes Testados**:
- `AuthGuard` component
- Layouts protegidos: `(protected)` e `(admin)`

---

## ‚úÖ Checklist de Testes

### 1. **Prote√ß√£o B√°sica (Apenas Autentica√ß√£o)**

#### 1.1 Usu√°rio N√£o Autenticado
- [ ] AuthGuard sem props ‚Üí redireciona para `/login`
- [ ] Par√¢metro `redirect` √© adicionado √† URL
- [ ] Loading aparece brevemente durante verifica√ß√£o
- [ ] Conte√∫do N√ÉO √© renderizado (seguran√ßa)

#### 1.2 Usu√°rio Autenticado
- [ ] AuthGuard sem props ‚Üí renderiza conte√∫do normalmente
- [ ] N√£o h√° redirecionamento
- [ ] Loading desaparece ap√≥s verifica√ß√£o
- [ ] Conte√∫do √© renderizado

---

### 2. **Verifica√ß√£o de Role - requiredRole**

#### 2.1 Admin Acessando
- [ ] `requiredRole="admin"` + user admin ‚Üí renderiza conte√∫do ‚úÖ
- [ ] `requiredRole="accountant"` + user admin ‚Üí renderiza conte√∫do ‚úÖ (hierarquia)
- [ ] `requiredRole="viewer"` + user admin ‚Üí renderiza conte√∫do ‚úÖ (hierarquia)

#### 2.2 Accountant Acessando
- [ ] `requiredRole="admin"` + user accountant ‚Üí acesso negado ‚õî
- [ ] `requiredRole="accountant"` + user accountant ‚Üí renderiza conte√∫do ‚úÖ
- [ ] `requiredRole="viewer"` + user accountant ‚Üí renderiza conte√∫do ‚úÖ (hierarquia)

#### 2.3 Viewer Acessando
- [ ] `requiredRole="admin"` + user viewer ‚Üí acesso negado ‚õî
- [ ] `requiredRole="accountant"` + user viewer ‚Üí acesso negado ‚õî
- [ ] `requiredRole="viewer"` + user viewer ‚Üí renderiza conte√∫do ‚úÖ

#### 2.4 Sem Role
- [ ] Usu√°rio sem profile.role ‚Üí acesso negado para qualquer `requiredRole`
- [ ] Mensagem apropriada: "Nenhum role atribu√≠do"

---

### 3. **Verifica√ß√£o de Role - allowedRoles (N√£o Hier√°rquica)**

#### 3.1 Lista de Roles Permitidas
- [ ] `allowedRoles={["admin"]}` + user admin ‚Üí renderiza ‚úÖ
- [ ] `allowedRoles={["admin"]}` + user accountant ‚Üí acesso negado ‚õî
- [ ] `allowedRoles={["admin", "accountant"]}` + user admin ‚Üí renderiza ‚úÖ
- [ ] `allowedRoles={["admin", "accountant"]}` + user accountant ‚Üí renderiza ‚úÖ
- [ ] `allowedRoles={["admin", "accountant"]}` + user viewer ‚Üí acesso negado ‚õî

#### 3.2 Diferen√ßa de allowedRoles vs requiredRole
- [ ] `allowedRoles={["accountant"]}` + user admin ‚Üí acesso negado ‚õî (n√£o hier√°rquica!)
- [ ] `requiredRole="accountant"` + user admin ‚Üí renderiza ‚úÖ (hier√°rquica!)
- [ ] Comportamento diferente est√° documentado

---

### 4. **Loading States**

#### 4.1 Loading Padr√£o (fullScreen=true)
- [ ] Exibe tela fullscreen com gradient azul/teal
- [ ] Spinner animado centralizado
- [ ] Texto: "Verificando permiss√µes..."
- [ ] Design consistente com tema do app

#### 4.2 Loading Inline (fullScreen=false)
- [ ] Exibe apenas spinner pequeno
- [ ] N√£o ocupa tela inteira
- [ ] Padding apropriado (py-12)

#### 4.3 Loading Customizado
- [ ] `loadingFallback={<Custom />}` ‚Üí renderiza componente customizado
- [ ] Loading padr√£o N√ÉO aparece
- [ ] Skeleton screens funcionam

---

### 5. **Acesso Negado (Role Insuficiente)**

#### 5.1 Tela Fullscreen (fullScreen=true)
- [ ] Gradient vermelho/laranja de fundo
- [ ] √çcone de cadeado (Lock) grande
- [ ] T√≠tulo: "Acesso Negado"
- [ ] Mostra role do usu√°rio atual
- [ ] Mostra role necess√°ria
- [ ] Bot√µes: "Voltar" e "Ir para In√≠cio"
- [ ] Bot√£o "Voltar" chama `router.back()`
- [ ] Bot√£o "In√≠cio" redireciona para `/`

#### 5.2 Tela Inline (fullScreen=false)
- [ ] Card vermelho claro com borda
- [ ] √çcone de cadeado pequeno
- [ ] Mensagem curta de acesso negado
- [ ] N√£o ocupa tela inteira
- [ ] Integra-se com o layout existente

#### 5.3 Acesso Negado Customizado
- [ ] `accessDeniedFallback={<Custom />}` ‚Üí renderiza componente customizado
- [ ] Tela padr√£o N√ÉO aparece
- [ ] Componente recebe controle total

---

### 6. **Usu√°rio N√£o Autenticado**

#### 6.1 Com Redirecionamento (noRedirect=false - padr√£o)
- [ ] Redireciona automaticamente para `/login`
- [ ] Par√¢metro `redirect` inclui URL atual
- [ ] N√£o exibe conte√∫do protegido
- [ ] Redirecionamento √© r√°pido (< 500ms)

#### 6.2 Sem Redirecionamento (noRedirect=true, fullScreen=true)
- [ ] Exibe tela fullscreen com ShieldAlert icon
- [ ] Gradient cinza de fundo
- [ ] T√≠tulo: "Autentica√ß√£o Necess√°ria"
- [ ] Bot√£o: "Fazer Login" ‚Üí redireciona para `/login`

#### 6.3 Com Fallback Customizado
- [ ] `fallback={<Custom />}` ‚Üí renderiza componente customizado
- [ ] Tela padr√£o N√ÉO aparece
- [ ] N√£o redireciona (mesmo com noRedirect=false)

---

### 7. **Props Customiz√°veis**

#### 7.1 redirectTo
- [ ] `redirectTo="/custom-login"` ‚Üí redireciona para rota customizada
- [ ] Par√¢metro `redirect` ainda √© adicionado
- [ ] URL customizada √© respeitada

#### 7.2 noRedirect
- [ ] `noRedirect=true` ‚Üí n√£o redireciona automaticamente
- [ ] Mostra tela de autentica√ß√£o necess√°ria
- [ ] Conte√∫do protegido N√ÉO √© renderizado

#### 7.3 fullScreen
- [ ] `fullScreen=true` (padr√£o) ‚Üí telas ocupam altura total
- [ ] `fullScreen=false` ‚Üí componentes inline/pequenos
- [ ] Transi√ß√£o entre modos funciona

---

### 8. **Integra√ß√£o com Layouts**

#### 8.1 Layout (protected)
- [ ] Criado em `src/app/(protected)/layout.tsx`
- [ ] Envolve children com `<AuthGuard>`
- [ ] P√°ginas dentro do grupo s√£o protegidas automaticamente
- [ ] N√£o autenticado ‚Üí redireciona para login

#### 8.2 Layout (admin)
- [ ] Criado em `src/app/(admin)/layout.tsx`
- [ ] Envolve children com `<AuthGuard requiredRole="admin">`
- [ ] Apenas admins podem acessar p√°ginas do grupo
- [ ] N√£o-admin ‚Üí tela de acesso negado

#### 8.3 AuthErrorHandler
- [ ] Inclu√≠do em ambos os layouts
- [ ] Erros do middleware s√£o capturados
- [ ] Toasts s√£o exibidos

---

### 9. **Renderiza√ß√£o Condicional**

#### 9.1 Componente Inline (noRedirect + fullScreen=false)
- [ ] Componente aparece/desaparece baseado em role
- [ ] N√£o causa layout shift significativo
- [ ] N√£o exibe erros no console

#### 9.2 M√∫ltiplos AuthGuards na Mesma P√°gina
- [ ] `<AuthGuard requiredRole="admin">` + `<AuthGuard requiredRole="viewer">`
- [ ] Ambos funcionam independentemente
- [ ] Renderizam conte√∫do apropriado para cada role
- [ ] Performance aceit√°vel

---

### 10. **Props Interface e TypeScript**

#### 10.1 Tipos Corretos
- [ ] `children: ReactNode` aceita qualquer conte√∫do React
- [ ] `requiredRole` aceita apenas: "admin", "accountant", "viewer"
- [ ] `allowedRoles` aceita array de roles v√°lidas
- [ ] `fallback`, `loadingFallback`, `accessDeniedFallback` aceitam ReactNode
- [ ] `noRedirect`, `fullScreen` s√£o boolean
- [ ] `redirectTo` √© string

#### 10.2 Defaults
- [ ] `noRedirect` = false por padr√£o
- [ ] `redirectTo` = "/login" por padr√£o
- [ ] `fullScreen` = true por padr√£o

#### 10.3 Props Opcionais
- [ ] Todas as props s√£o opcionais exceto `children`
- [ ] TypeScript n√£o reclama de props ausentes
- [ ] Comportamento padr√£o √© sensato

---

### 11. **Performance**

#### 11.1 Tempo de Verifica√ß√£o
- [ ] Verifica√ß√£o de autentica√ß√£o < 100ms
- [ ] Verifica√ß√£o de role < 50ms (j√° tem user em context)
- [ ] Renderiza√ß√£o de conte√∫do √© imediata ap√≥s verifica√ß√£o

#### 11.2 Re-renders
- [ ] AuthGuard n√£o causa re-renders desnecess√°rios
- [ ] useAuth context atualiza apenas quando necess√°rio
- [ ] Mudan√ßas de rota n√£o causam flicker

---

### 12. **Seguran√ßa**

#### 12.1 Conte√∫do Nunca Exposto
- [ ] Conte√∫do protegido NUNCA renderiza antes de verifica√ß√£o
- [ ] Inspecionar DOM n√£o revela conte√∫do protegido
- [ ] DevTools n√£o mostram conte√∫do em nenhum momento

#### 12.2 Dupla Prote√ß√£o (Middleware + AuthGuard)
- [ ] Middleware bloqueia no servidor
- [ ] AuthGuard bloqueia no cliente
- [ ] Se middleware falhar, AuthGuard captura
- [ ] Se AuthGuard falhar, middleware j√° bloqueou

#### 12.3 Falha Segura
- [ ] Em caso de erro no useAuth ‚Üí assume n√£o autenticado
- [ ] Em caso de role undefined ‚Üí assume sem permiss√£o
- [ ] Nunca "abre" acesso por engano

---

### 13. **UX e Acessibilidade**

#### 13.1 Loading States
- [ ] Loading sempre vis√≠vel durante verifica√ß√£o
- [ ] N√£o h√° "flash" de conte√∫do protegido
- [ ] Transi√ß√µes suaves entre estados

#### 13.2 Mensagens Claras
- [ ] Textos explicam claramente o problema
- [ ] Mensagens s√£o amig√°veis, n√£o t√©cnicas
- [ ] Bot√µes t√™m labels descritivos

#### 13.3 Navega√ß√£o
- [ ] Bot√µes de navega√ß√£o funcionam corretamente
- [ ] `router.back()` funciona em todos os casos
- [ ] Redirecionamento para home sempre funciona

#### 13.4 Responsividade
- [ ] Telas fullscreen funcionam em mobile
- [ ] Bot√µes s√£o clic√°veis em touch screens
- [ ] Layout adapta em diferentes tamanhos
- [ ] Texto √© leg√≠vel em telas pequenas

---

### 14. **Exemplos Pr√°ticos**

#### 14.1 Arquivo examples.tsx
- [ ] Todos os 10 exemplos est√£o implementados
- [ ] Exemplos cobrem casos de uso comuns
- [ ] C√≥digo √© execut√°vel (n√£o apenas pseudoc√≥digo)
- [ ] Coment√°rios explicam cada exemplo

#### 14.2 Uso dos Exemplos
- [ ] Exemplo 1 (B√°sico) funciona
- [ ] Exemplo 2 (Admin) funciona
- [ ] Exemplo 3 (M√∫ltiplas Roles) funciona
- [ ] Exemplo 4 (Inline) funciona
- [ ] Exemplo 5 (Loading Custom) funciona
- [ ] Exemplo 6 (Acesso Negado Custom) funciona
- [ ] Exemplo 7 (Sem Redirect) funciona
- [ ] Exemplo 8 (Componente Espec√≠fico) funciona
- [ ] Exemplo 9 (Layouts) funciona
- [ ] Exemplo 10 (Renderiza√ß√£o Condicional) funciona

---

### 15. **Documenta√ß√£o**

#### 15.1 JSDoc
- [ ] Componente principal tem JSDoc completo
- [ ] Todas as props t√™m descri√ß√µes
- [ ] Exemplos de uso no JSDoc
- [ ] Tags `@example` est√£o corretas

#### 15.2 Coment√°rios no C√≥digo
- [ ] Cada se√ß√£o tem coment√°rio explicativo
- [ ] L√≥gica complexa tem coment√°rios inline
- [ ] TODO items (se houver) est√£o marcados

#### 15.3 TypeScript
- [ ] Interface exportada: `AuthGuardProps`
- [ ] Tipos s√£o precisos e √∫teis
- [ ] Auto-complete funciona no IDE

---

### 16. **Edge Cases**

#### 16.1 Cen√°rios Raros
- [ ] User existe mas profile √© null ‚Üí trata como sem role
- [ ] Role inv√°lida/desconhecida ‚Üí nega acesso
- [ ] Loading nunca termina ‚Üí timeout do AuthProvider resolve
- [ ] M√∫ltiplos AuthGuards aninhados ‚Üí funcionam corretamente

#### 16.2 Navega√ß√£o Complexa
- [ ] Navegar de rota protegida para p√∫blica ‚Üí OK
- [ ] Navegar de rota p√∫blica para protegida ‚Üí OK
- [ ] Refresh em rota protegida ‚Üí mant√©m acesso
- [ ] Logout em rota protegida ‚Üí redireciona para login

---

### 17. **Testes de Integra√ß√£o**

#### 17.1 Fluxo Completo: Login ‚Üí Rota Protegida
1. [ ] N√£o autenticado tenta acessar rota com `<AuthGuard>`
2. [ ] AuthGuard redireciona para `/login?redirect=/rota`
3. [ ] Usu√°rio faz login
4. [ ] Redireciona de volta para `/rota`
5. [ ] AuthGuard verifica sess√£o ‚Üí OK
6. [ ] Conte√∫do √© renderizado

#### 17.2 Fluxo Completo: Viewer Tenta Acessar Admin
1. [ ] Viewer acessa rota com `<AuthGuard requiredRole="admin">`
2. [ ] AuthGuard verifica role ‚Üí insuficiente
3. [ ] Exibe tela "Acesso Negado"
4. [ ] Mostra role atual (viewer) e necess√°ria (admin)
5. [ ] Bot√µes de navega√ß√£o funcionam

#### 17.3 Fluxo Completo: Mudan√ßa de Role
1. [ ] Admin est√° em rota admin (renderizando)
2. [ ] Role √© alterada para viewer (no banco)
3. [ ] useAuth detecta mudan√ßa (ap√≥s refresh ou re-fetch)
4. [ ] AuthGuard re-verifica
5. [ ] Exibe "Acesso Negado"

---

### 18. **Compara√ß√£o: Middleware vs AuthGuard**

#### 18.1 Quando Usar Cada Um

| Cen√°rio | Middleware | AuthGuard | Ambos |
|---------|------------|-----------|-------|
| Proteger p√°gina inteira | ‚úÖ | ‚úÖ | ‚úÖ‚úÖ |
| Proteger se√ß√£o da p√°gina | ‚ùå | ‚úÖ | - |
| Proteger componente | ‚ùå | ‚úÖ | - |
| Evitar carregamento de JS | ‚úÖ | ‚ùå | - |
| Fallback customizado | ‚ùå | ‚úÖ | - |
| Verifica√ß√£o server-side | ‚úÖ | ‚ùå | - |
| Verifica√ß√£o client-side | ‚ùå | ‚úÖ | - |

#### 18.2 Teste: Desabilitar Middleware
- [ ] Com middleware desabilitado, AuthGuard ainda protege
- [ ] Rota protegida ainda redireciona (mas mais lento)
- [ ] Conte√∫do nunca vaza

#### 18.3 Teste: Desabilitar AuthGuard
- [ ] Com AuthGuard desabilitado, middleware ainda protege
- [ ] P√°gina n√£o carrega sem autentica√ß√£o
- [ ] Redirecionamento acontece no servidor

---

## üìä Resumo de Testes

**Total de Testes**: ~150 casos

### Categorias:
- ‚úÖ Prote√ß√£o B√°sica: 4 testes
- ‚úÖ Verifica√ß√£o de Role (requiredRole): 13 testes
- ‚úÖ Verifica√ß√£o de Role (allowedRoles): 8 testes
- ‚úÖ Loading States: 9 testes
- ‚úÖ Acesso Negado: 11 testes
- ‚úÖ Usu√°rio N√£o Autenticado: 9 testes
- ‚úÖ Props Customiz√°veis: 8 testes
- ‚úÖ Integra√ß√£o com Layouts: 8 testes
- ‚úÖ Renderiza√ß√£o Condicional: 5 testes
- ‚úÖ TypeScript: 9 testes
- ‚úÖ Performance: 5 testes
- ‚úÖ Seguran√ßa: 7 testes
- ‚úÖ UX e Acessibilidade: 12 testes
- ‚úÖ Exemplos Pr√°ticos: 11 testes
- ‚úÖ Documenta√ß√£o: 8 testes
- ‚úÖ Edge Cases: 8 testes
- ‚úÖ Testes de Integra√ß√£o: 13 testes
- ‚úÖ Compara√ß√£o: 8 testes

---

## üöÄ Como Testar

### Prepara√ß√£o
1. Certifique-se de ter usu√°rios de teste com diferentes roles:
   - Admin, Accountant, Viewer
2. Abra DevTools (F12)
3. Use modo an√¥nimo para testar fluxos de n√£o autenticado

### Executar Testes
1. **Testes Manuais**: Seguir cada item do checklist
2. **Valida√ß√£o**: Marcar ‚úÖ cada teste que passar
3. **Bugs**: Documentar qualquer falha encontrada

### Casos de Teste R√°pidos

#### Teste 1: Prote√ß√£o B√°sica (1min)
```tsx
<AuthGuard>
  <p>Conte√∫do Protegido</p>
</AuthGuard>
```
- ‚úÖ N√£o autenticado ‚Üí redireciona
- ‚úÖ Autenticado ‚Üí renderiza

#### Teste 2: Role Admin (1min)
```tsx
<AuthGuard requiredRole="admin">
  <p>Apenas Admin</p>
</AuthGuard>
```
- ‚úÖ Admin ‚Üí renderiza
- ‚úÖ N√£o-admin ‚Üí acesso negado

#### Teste 3: Inline (30s)
```tsx
<AuthGuard fullScreen={false} noRedirect requiredRole="admin">
  <button>Admin Only</button>
</AuthGuard>
```
- ‚úÖ Admin ‚Üí bot√£o aparece
- ‚úÖ N√£o-admin ‚Üí nada aparece

---

## ‚úÖ Crit√©rios de Aceita√ß√£o

A Fase 8 √© considerada **COMPLETA** quando:

- [ ] ‚úÖ 100% dos testes de prote√ß√£o b√°sica passam
- [ ] ‚úÖ 100% dos testes de verifica√ß√£o de role passam
- [ ] ‚úÖ Todos os fallbacks customiz√°veis funcionam
- [ ] ‚úÖ Layouts protegidos funcionam corretamente
- [ ] ‚úÖ Exemplos pr√°ticos s√£o execut√°veis
- [ ] ‚úÖ Documenta√ß√£o completa e precisa
- [ ] ‚úÖ TypeScript sem erros
- [ ] ‚úÖ Performance aceit√°vel
- [ ] ‚úÖ Seguran√ßa validada
- [ ] ‚úÖ Sem bugs cr√≠ticos

---

**√öltima atualiza√ß√£o**: 2025-10-22  
**Respons√°vel pelos testes**: Marcos Rocha  
**Status**: Aguardando execu√ß√£o


